"use strict";var User=require("../models/auth"),jwt=require("jsonwebtoken"),bcrypt=require("bcryptjs"),_require=require("../validation"),registerValidation=_require.registerValidation,loginValidation=_require.loginValidation,_require2=require("joi"),isError=_require2.isError,valid=_require2.valid,registerPost=function(r,t){var n,a,s,i,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=registerValidation(r.body),a=n.error)return e.abrupt("return",t.status(400).send(a.details[0].message));e.next=3;break;case 3:return e.next=5,regeneratorRuntime.awrap(User.findOne({email:r.body.email}));case 5:return e.sent&&t.status(400).send("Email already exists"),e.next=9,regeneratorRuntime.awrap(bcrypt.genSalt(10));case 9:return s=e.sent,e.next=12,regeneratorRuntime.awrap(bcrypt.hash(r.body.password,s));case 12:return i=e.sent,o=new User({name:r.body.name,email:r.body.email,password:i}),e.prev=14,e.next=17,regeneratorRuntime.awrap(o.save());case 17:e.sent,e.next=23;break;case 20:e.prev=20,e.t0=e.catch(14),t.status(400).send(e.t0);case 23:case"end":return e.stop()}},null,null,[[14,20]])},loginPost=function(r,t){var n,a,s,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=loginValidation(r.body),a=n.error)return e.abrupt("return",t.status(400).send(a.details[0].message));e.next=3;break;case 3:return e.next=5,regeneratorRuntime.awrap(User.findOne({email:r.body.email}));case 5:if(s=e.sent){e.next=8;break}return e.abrupt("return",t.status(400).send("Email is not found"));case 8:return e.next=10,regeneratorRuntime.awrap(bcrypt.compare(r.body.password,s.password));case 10:if(e.sent){e.next=13;break}return e.abrupt("return",t.status(400).send("Login failed"));case 13:i=jwt.sign({_id:s._id},process.env.TOKEN_SECRET),t.header("Authorization",i).send({token:i});case 15:case"end":return e.stop()}})};module.exports={registerPost:registerPost,loginPost:loginPost};
//# sourceMappingURL=authPost.min.js.map
